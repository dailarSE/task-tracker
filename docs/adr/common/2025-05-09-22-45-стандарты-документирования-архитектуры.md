# ADR-0013: Стандарты и подходы к документированию архитектурных решений и диаграмм

**Статус:** Accepted

**Дата:** 2025-05-09

## 1. Контекст

По мере развития проекта "Task Tracker" и усложнения его архитектуры возникает необходимость в консистентном и эффективном документировании принятых архитектурных решений, структуры системы и ее компонентов. Документация должна быть легко доступна, версионируема вместе с кодом и понятна как текущим, так и будущим членам команды. Отсутствие стандартов документирования может привести к устареванию информации, разночтениям и потере знаний о причинах тех или иных проектных выборов.

## 2. Принятое Решение

1.  **Architecture Decision Records (ADR):**
    *   **Назначение:** Для фиксации всех архитектурно значимых решений, их контекста, рассмотренных альтернатив и последствий.
    *   **Формат:** Markdown (`.md`).
    *   **Хранение:** В Git-репозитории, в директории `docs/adr/`.
    *   **Структура директорий ADR:** ADR группируются по тематическим поддиректориям (например, `common`, `backend-service`, `database`, `observability`, `ci-cd`, etc.) внутри `docs/adr/` для лучшей организации.
    *   **Именование файлов ADR:** Используется формат `YYYY-MM-DD-HH-MM-краткое-описательное-имя.md` (например, `2025-05-10-10-00-пример-решения.md`). Временная метка обеспечивает глобальную хронологию и уникальность.
    *   **Шаблон ADR:** Используется стандартный шаблон, включающий как минимум: Заголовок (с номером ADR), Статус, Дату, Контекст, Принятое Решение, Рассмотренные Альтернативы, Последствия. Номер ADR присваивается последовательно (например, ADR-0001, ADR-0002).
    *   **Процесс:** Решения обсуждаются командой; ответственный (обычно архитектор или тимлид) формулирует ADR; ADR может проходить неформальное ревью командой.
2.  **Архитектурные Диаграммы (C4 Model):**
    *   **Назначение:** Для визуализации архитектуры на различных уровнях абстракции (Контекст, Контейнеры, Компоненты).
    *   **Инструмент:** `draw.io` для создания и редактирования диаграмм.
    *   **Исходный формат:** Файлы `.drawio` (XML) сохраняются в Git.
    *   **Формат для публикации/документации:** Диаграммы экспортируются в формат **WebP (lossless)** для вставки в Markdown-документы (ADR, README).
    *   **Хранение:** Исходники (`.drawio`) и экспортированные изображения (`.webp`) хранятся в Git-репозитории в директории `docs/diagrams/`. Для детализирующих диаграмм используются поддиректории, соответствующие элементу верхнего уровня (например, `docs/diagrams/task-tracker-system/backend-api/`).
    *   **Именование файлов диаграмм:** `c4-L[Уровень]-описание.drawio` и `c4-L[Уровень]-описание.webp` (например, `c4-L1-system-context.webp`, `c4-L2-containers-task-tracker-system.webp`).
3.  **Файлы `README.md`:**
    *   **Корневой `README.md`:** Содержит общее описание проекта, инструкции по запуску, ссылки на ключевые разделы документации (включая ADR и диаграммы).
    *   **`README.md` на уровне модулей/сервисов:** Содержат специфичную информацию для данного модуля.
4.  **Confluence (или аналогичная Wiki):**
    *   Используется для хранения "живой" информации, не подходящей для Git: практические гайды, протоколы встреч (если не формализованы в ADR), информация о команде, общие процессы.
    *   Не используется для дублирования ADR или диаграмм, которые хранятся в Git. Может содержать обзорные страницы со ссылками на документацию в Git.

## 3. Рассмотренные Альтернативы

1.  **Только Wiki (Confluence) для всей документации:**
    *   **Минусы:** Сложнее версионировать архитектурные решения вместе с кодом, информация может легче устаревать и терять связь с конкретными изменениями в коде.
2.  **Использование PlantUML или Mermaid для всех диаграмм:**
    *   **Плюсы:** "Диаграммы как код", отличное версионирование.
    *   **Минусы:** Ограниченный контроль над финальной раскладкой диаграмм, что может приводить к пересечениям и ухудшению читаемости, как показал опыт с Mermaid. `draw.io` дает полный контроль над визуализацией.
3.  **Хранение только изображений диаграмм без исходников `.drawio`:**
    *   **Минусы:** Затрудняет последующее редактирование диаграмм.
4.  **Плоский список ADR без тематических директорий или только простая нумерация:**
    *   **Минусы:** Сложнее навигация и поиск при большом количестве ADR. Выбранный подход (тематические директории + timestamp в имени) обеспечивает и группировку, и хронологию.

## 4. Последствия

*   **Положительные:**
    *   Создается единый, версионируемый источник правды для архитектурных решений и диаграмм, тесно связанный с кодовой базой.
    *   Улучшается понимание архитектуры и истории ее развития для всех членов команды.
    *   Упрощается онбординг новых разработчиков.
    *   Снижается риск потери знаний о причинах принятия решений.
    *   Сочетание текстовых ADR и визуальных диаграмм дает комплексное представление.
*   **Отрицательные/Затраты:**
    *   Требуется дисциплина для регулярного создания и обновления ADR и диаграмм.
    *   Необходимо поддерживать консистентность между ADR, диаграммами и реальной реализацией.
    *   Затраты времени на написание ADR и создание/обновление диаграмм.
*   **Необходимые действия:**
    *   Создать начальную структуру директорий `docs/adr/` и `docs/diagrams/`.
    *   Начать документировать уже принятые решения в формате ADR.
    *   Создать первые C4 диаграммы.
    *   Обновить `README.md` со ссылками на документацию.